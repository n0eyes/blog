---
title: ì´ë¯¸ì§€ ê²½í—˜ ê°œì„ í•˜ê¸°
description: í”„ë¡œ ë¶ˆí¸ëŸ¬ì˜ ì´ë¯¸ì§€ ê²½í—˜ ê°œì„ í•˜ê¸°
date: 2024-06-06
draft: false
tags:
  - image
  - ux
  - dx
---
## Intro
í˜¹ì‹œ ì´ë¯¸ì§€ë¥¼ ë Œë”ë§í•˜ëŠ” ê³¼ì •ì—ì„œ ì´ë¯¸ì§€ê°€ ëšëš ëŠê¸°ë©° ë Œë”ë§ë˜ì–´ ë¶ˆí¸í–ˆë˜ ê²½í—˜ì´ ìˆë‚˜ìš”? 

ì˜¤ëŠ˜ì€ ì œê°€ ê²ªì€ ì´ë¯¸ì§€ ê²½í—˜ì„ ê°œì„ í–ˆë˜ ê³¼ì •ì„ ê³µìœ í•˜ë ¤ê³  í•©ë‹ˆë‹¤.

## ë¬¸ì œ ìƒí™©
ì •ì  í˜¸ìŠ¤íŒ…ì´ ì•„ë‹Œ ê²½ìš° ì¼ë°˜ì ìœ¼ë¡œ ì´ë¯¸ì§€ ê²½ë¡œëŠ” ì„œë²„ë¡œë¶€í„° ì „ë‹¬ë°›ê²Œ ë©ë‹ˆë‹¤. ê·¸ë¦¬ê³  ì„œë²„ë¡œë¶€í„° ì‘ë‹µì´ ì˜¬ ë•Œ ê¹Œì§€ ìŠ¤ì¼ˆë ˆí†¤ê³¼ ê°™ì€ UIë¥¼ ì œê³µí•˜ì—¬ ì‚¬ìš©ì ê²½í˜ í–¥ìƒì„ ë„ëª¨í•©ë‹ˆë‹¤.

í•˜ì§€ë§Œ ë¬¸ì œëŠ” ë¸Œë¼ìš°ì €ê°€ ì´ë¯¸ì§€ë¥¼ ë‹¤ìš´ë¡œë“œ ë°›ëŠ” ì‹œê°„ì´ ë³„ë„ë¡œ ë°œìƒí•œë‹¤ëŠ” ê²ƒì…ë‹ˆë‹¤. ê·¸ ê²°ê³¼, ë¸Œë¼ìš°ì €ê°€ ì´ë¯¸ì§€ë¥¼ ë‹¤ìš´ë¡œë“œ í•˜ê³  ìŠ¤íŠ¸ë¦¬ë° í•˜ëŠ” ê³¼ì •ì´ ê·¸ëŒ€ë¡œ ë“œëŸ¬ë‚©ë‹ˆë‹¤.
> ![ê°œì„  ì „](https://velog.velcdn.com/images/n0eyes/post/cda74c1f-b1ea-445e-b0ab-5ff4abd28602/image.gif)

ì¼ë°˜ì ìœ¼ë¡œ ì™¼ìª½ ìƒë‹¨ë¶€í„° ìš°ì¸¡ í•˜ë‹¨ìœ¼ë¡œ ìŠ¤íŠ¸ë¦¬ë° ë˜ëŠ” ê²ƒì„ í™•ì¸í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.

> ì„œë²„ê°€ ì‘ë‹µ > ì´ë¯¸ì§€ ê²½ë¡œ ì‚½ì… > ë¸Œë¼ìš°ì €ê°€ ì´ë¯¸ì§€ ë¡œë“œ ì‹œì‘

## ê°œì„  (1)
ì´ì™€ ê°™ì€ ê²½í—˜ì„ ê°œì„ í•˜ê³ ì í”Œë ˆì´ìŠ¤í™€ë”ë¥¼ ì‚¬ìš©í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤. ë¸Œë¼ìš°ì €ëŠ” ì´ë¯¸ì§€ ê°ì²´ì˜ src í”„ë¡œí¼í‹°ì— ê²½ë¡œê°€ ì‚½ì…ë˜ëŠ” ìˆœê°„ ì´ë¯¸ì§€ë¥¼ ë‹¤ìš´ë¡œë“œí•˜ê¸° ì‹œì‘í•©ë‹ˆë‹¤. ì´ë¥¼ í™œìš©í•˜ì—¬ í”Œë ˆì´ìŠ¤í™€ë”ë¡œ ìŠ¤ì¼ˆë ˆí†¤ì„ ë…¸ì¶œí•´ ë³´ê² ìŠµë‹ˆë‹¤.

```tsx
type ImageComponentProps = {
  loadingFallback: ReactNode;
} & ComponentPropsWithoutRef<'img'>;

const ImageComponent = (props: ImageComponentProps) => {
  const { loadingFallback, ...restProps } = props;
  const [loaded, setLoaded] = useState(false);

  const handleImageLoaded = () => {
    setStatus(true);
  };

  if (!loaded) {
    const img = new Image();

    img.src = props.src;
    img.onload = handleImageLoaded;

    return loadingFallback;
  }

  return <img {...restProps} />;
};
```
ì´ë¯¸ì§€ê°€ ë¡œë“œë˜ì§€ ì•Šì€ ê²½ìš° loadingFallbackì„ ë Œë”ë§í•˜ê³  ì´ë¯¸ì§€ ê°ì²´ë¥¼ ë§Œë“¤ì–´ ê²½ë¡œë¥¼ ì‚½ì…í•¨ìœ¼ë¡œì„œ ì´ë¯¸ì§€ ë‹¤ìš´ë¡œë“œë¥¼ ìš”ì²­í•©ë‹ˆë‹¤.

ì´ë¯¸ì§€ê°€ ë‹¤ìš´ë¡œë“œ ëœ ê²ƒì€ onload ì´ë²¤íŠ¸í•¸ë“¤ëŸ¬ë¥¼ í†µí•´ ê°ì§€í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤. loaded ìƒíƒœë¥¼ ë³€ê²½í•˜ê¸° ì ì ˆí•œ íƒ€ì´ë°ì…ë‹ˆë‹¤.

ì˜ ë™ì‘í•˜ëŠ” ê²ƒì„ í™•ì¸í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.
![ê°œì„  1](https://velog.velcdn.com/images/n0eyes/post/6266e226-1f9c-4026-b838-2171ad89eb2e/image.gif)

## ê°œì„  (2)
ì§€ê¸ˆê¹Œì§„ ì´ë¯¸ì§€ê°€ ì„±ê³µì ìœ¼ë¡œ ë¡œë“œë˜ëŠ” ê²½ìš°ë§Œ ë‹¤ë£¨ì—ˆìŠµë‹ˆë‹¤. ì´ë¯¸ì§€ ë¡œë“œê°€ ì‹¤íŒ¨í•˜ëŠ” ê²½ìš°ë„ ëŒ€ì‘í•´ ë³´ê² ìŠµë‹ˆë‹¤.

ë¡œë”© ìƒíƒœë¥¼ ì¡°ê¸ˆ ë” ì„¸ë¶„í™” í•´ì£¼ë©´ í° ë³€ê²½ ì—†ì´ ëŒ€ì‘ ê°€ëŠ¥í•©ë‹ˆë‹¤.
```tsx
type ImageComponentProps = {
  loadingFallback: ReactNode;
  errorFallback: ReactNode;
} & ComponentPropsWithoutRef<'img'>;

const ImageComponent = (props: ImageComponentProps) => {
  const { loadingFallback, errorFallback, ...restProps } = props;
  const [status, setStatus] = useState<'loading' | 'success' | 'error'>('loading');

  const handleImageLoaded = () => {
    setStatus('success');
  };

  const handleImageFailed = () => {
    setStatus('error');
  };

  if (status === 'error') {
    return errorFallback;
  }

  if (status === 'loading') {
    const img = new Image();

    img.src = props.src
    img.onload = handleImageLoaded;
    img.onerror = handleImageFailed;

    return loadingFallback;
  }

  return <img {...restProps} />;
};
```
ì˜ ë™ì‘í•˜ëŠ” ê²ƒì„ í™•ì¸í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.
![ì´ë¯¸ì§€ ìš”ì²­ ì‹¤íŒ¨](https://velog.velcdn.com/images/n0eyes/post/17fd99a3-e5ef-4136-a30f-46716e8d0624/image.gif)

## ë‹¤ì‹œ ë¬¸ì œ..
ì§€ê¸ˆê¹Œì§€ ì´ë¯¸ì§€ê°€ ë¡œë”©ì¤‘ì¸ ê²½ìš°, ì‹¤íŒ¨í•œ ê²½ìš°ë¥¼ ëŒ€ì‘í•´ ë³´ì•˜ìŠµë‹ˆë‹¤. ë‘ ê²½ìš° ëª¨ë‘ ImageComponent ë‚´ë¶€ì—ì„œ ì´ë¤„ì¡ŒëŠ”ë°ìš”. ì´ëŠ” í•´ë‹¹ ì´ë¯¸ì§€ì˜ statusê°€ ImageComponent ë‚´ë¶€ì— ì¢…ì†ë˜ëŠ” ë‹¨ì ì´ ìˆìŠµë‹ˆë‹¤. ì´ ë‹¨ì ì€ ì–¸ì œ ë‹¤ê°€ì˜¬ê¹Œìš”?

UXë¥¼ íŒë‹¨í•˜ëŠ” ê¸°ì¤€ì— ë”°ë¼ ë‹¤ë¥´ê² ì§€ë§Œ, ì´ë¯¸ì§€ê°€ ëª¨ë‘ ë¡œë“œë˜ì—ˆì„ ë•Œ ê´€ë ¨ ì •ë³´ë“¤ì„ í•¨ê»˜ ë…¸ì¶œí•˜ê³  ì‹¶ì„ ìˆ˜ ìˆìŠµë‹ˆë‹¤. ë˜í•œ, ì´ë¯¸ì§€ ë¡œë“œê°€ ì‹¤íŒ¨í•œ ê²½ìš° ê´€ë ¨ ì •ë³´ë“¤ë„ í•¨ê»˜ ì „ë‹¬í•˜ê³  ì‹¶ì§€ ì•Šì„ ìˆ˜ë„ ìˆìŠµë‹ˆë‹¤.

ì˜ˆë¥¼ ë“¤ì–´, ì˜·ì„ êµ¬ë§¤í•˜ëŠ” ì‚¬ìš©ìê°€ ë³´ê³  ìˆëŠ” ìƒí’ˆ ì•„ë˜ì— ë‹¤ë¥¸ ìƒí’ˆì„ ë…¸ì¶œí•´ì•¼ í•˜ëŠ” ê²½ìš°ë¥¼ ìƒìƒí•´ë³¼ ìˆ˜ ìˆìŠµë‹ˆë‹¤. ì˜·ì€ ë””ìì¸ì˜ ì˜í–¥ì„ ë§ì´ ë°›ëŠ” ì œí’ˆì´ê¸°ì— ì œí’ˆ ì´ë¯¸ì§€ ì—†ì´ ê°€ê²©ì´ë‚˜ ì´ë¦„ë§Œ ë…¸ì¶œëœ í’ˆëª©ì€ ì‚¬ìš©ìì—ê²Œ ì„ íƒë°›ì„ í™•ë¥ ì´ ë§¤ìš° ë‚®ìŠµë‹ˆë‹¤. ì´ì™€ ê°™ì€ ìƒí™©ì—ì„œ ì´ë¯¸ì§€ ë¡œë“œê°€ ì‹¤íŒ¨í•œ ìƒí’ˆì€ ë Œë”ë§ í•˜ì§€ ì•ŠìŒìœ¼ë¡œì„œ ë§¤ë„ëŸ¬ìš´ ìƒí’ˆ íƒìƒ‰ ê²½í—˜ì„ ì œê³µí•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.

ìœ„ì™€ ê°™ì€ ê²½ìš°ë¥¼ ê¸°ì¡´ì˜ ImageComponentë¥¼ í™œìš©í•˜ì—¬ ëŒ€ì‘í•´ ë³´ê² ìŠµë‹ˆë‹¤. ë¨¼ì € ImageComponentë¥¼ ì¡°ê¸ˆ ë³€ê²½í•˜ê² ìŠµë‹ˆë‹¤.

```tsx
const ImageComponent = (props: ImageComponentProps) => {
  ... 
  
  if (status === 'loading') {
    const img = new Image();

    img.src = props.src
    img.onload = compose(handleImageLoaded, props.onLoad);
    img.onerror = compose(handleImageFailed, props.onError);

    return loadingFallback;
  }

  return <img {...restProps} />;
};

```
ì™¸ë¶€ì—ì„œ ì£¼ì…ë˜ëŠ” load, error ì´ë²¤íŠ¸ í•¸ë“¤ëŸ¬ë¥¼ ì—°ë™í•˜ì˜€ìŠµë‹ˆë‹¤. ì´ì œ ë‹¤ìŒê³¼ ê°™ì´ ProductItemì„ êµ¬í˜„í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.

```tsx
const ProductItem = ({product}) => {
  const { name, price } = product
  
  const [status, setStatus] = useState<'loading' | 'success' | 'error'>('loading');

  const handleImageLoaded = () => {
    setStatus('success');
  };

  const handleImageFailed = () => {
    setStatus('error');
  };

  if (status === 'error') {
    return null;
  }

  if (status === 'loading') {
    return <Skeleton />
  }

  
 return 
  <div>
   	<ImageComponent src='thumbnail' onLoad={handleImageLoaded} onError={handleImageFailed}/> 
    <Name>{name}</Name>
    <Price>{price}</Price>
  </div>
}
```
statusë¥¼ ë‹¤ë£¨ëŠ” ë¶€ë¶„ì´ ìƒë‹¹íˆ ì¤‘ë³µë©ë‹ˆë‹¤. ì´ ë¶€ë¶„ì€ í›…ìœ¼ë¡œ ì¶”ì¶œí•˜ì—¬ ì—¬ì°¨ì €ì°¨ í•  ìˆ˜ ìˆë‹¤ê³  í•˜ê² ìŠµë‹ˆë‹¤.

ë§Œë“¤ê³  ë³´ë‹ˆ ìµìˆ™í•œ ëª¨ìŠµì´ ë³´ì´ì§€ ì•Šìœ¼ì‹ ê°€ìš”? ë‚´ë¶€ì ìœ¼ë¡œ statusë¥¼ ë‹¤ë£¨ëŠ” í˜•íƒœê°€ api statusë¥¼ ë‹¤ë£¨ëŠ” í˜•íƒœì™€ ë¹„ìŠ·í•©ë‹ˆë‹¤.

ìš°ë¦¬ëŠ” ì´ì™€ ê°™ì€ ìƒíƒœì—ì„œ ê´€ì‹¬ì‚¬ë¥¼ ë¶„ë¦¬í•˜ê³  ì„ ì–¸ì ìœ¼ë¡œ statusë¥¼ ë‹¤ë£° ìˆ˜ ìˆëŠ” apië¥¼ ì•Œê³  ìˆìŠµë‹ˆë‹¤. ë°”ë¡œ `suspense`ì…ë‹ˆë‹¤.

## í™•ì¥
`suspense`ëŠ” throwëœ promiseë¥¼ catchí•˜ì—¬ ì´í–‰ë  ê²½ìš° ë¦¬ë Œë”ë§ ì‹œí‚µë‹ˆë‹¤. ìš°ë¦¬ëŠ” promiseê°€ ì´í–‰ë  íƒ€ì´ë°ì„ ì•Œê³  ìˆìŠµë‹ˆë‹¤. ë°”ë¡œ ì´ë¯¸ì§€ê°€ ë¡œë“œëœ ê²½ìš°ì…ë‹ˆë‹¤.

ê¸°ì¡´ì˜ ImageComponentë¥¼ ë³€ê²½í•´ ë³´ê² ìŠµë‹ˆë‹¤.

```tsx
type SuspenseImgProps = ComponentPropsWithoutRef<'img'>

const SuspenseImg = (props: SuspenseImgProps) => {
  const { src, ...restProps } = props;
  
  useSuspense(() => {
    const { promise, resolve, reject } = Promise.withResolvers();

    const img = new Image();

    img.onload = resolve;
    img.onerror = reject;
    img.src = src!;

    return promise;
  });

  return <img {...props} />;
}
```

[useSuspenseì˜ ë™ì‘ ë°©ì‹ì´ ê¶ê¸ˆí•˜ì‹  ë¶„ë“¤ì€ ì°¸ê³ í•´ ì£¼ì„¸ìš”!](https://fe-developers.kakaoent.com/2021/211127-211209-suspense/)

ì´ì „ê³¼ ë‹¬ë¦¬ ì´ë¯¸ì§€ë¥¼ ë¡œë“œí•˜ëŠ” promiseë¥¼ throwí•©ë‹ˆë‹¤. ê·¸ë¦¬ê³  í•´ë‹¹ promiseëŠ” ì´ë¯¸ì§€ê°€ ë¡œë“œëœ ê²½ìš° resolveë©ë‹ˆë‹¤. 

í•œë²ˆ í™œìš©í•´ ë³¼ê¹Œìš”?

## ìµœì¢… ê°œì„ 
ì´ì „ì— ì‘ì„±í•œ ProductItemì„ ê°œì„ í•´ ë³´ê² ìŠµë‹ˆë‹¤.

ê¸°ì¡´ì— ì‘ì„±ëœ status ê´€ë¦¬ ë¡œì§ì„ ëª¨ë‘ ì œê±°í•˜ê³  `suspense`ì™€ `ErrorBoundary`ë¥¼ ì ìš©í•©ë‹ˆë‹¤.
```tsx
const ProductItem = ({product}) => {
  const { name, price } = product
  
 return 
  <ErrorBoundary fallback={null}>
    <Suspense fallback={<Skeleton />}>   
     <div>
        <SuspenseImg src='thumbnail' /> 
        <Name>{name}</Name>
        <Price>{price}</Price>
     </div>
    </Suspense>
  </ErrorBoundary>
}

```
í›¨ì”¬ ì§ê´€ì ì´ì§€ ì•Šë‚˜ìš”?

ì´ì œ ì´ë¯¸ì§€ statusì˜ ì—¬íŒŒ ë²”ìœ„ë¥¼ ì„ ì–¸ì ìœ¼ë¡œ ì¡°ì‘í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤. ê¸°ì¡´ì²˜ëŸ¼ ì´ë¯¸ì§€ë§Œ fallbackì„ ë³´ì—¬ì£¼ê³  ì‹¶ì€ ê²½ìš° ì´ë¯¸ì§€ë§Œ ê°ì‹¸ì£¼ë©´ ë˜ëŠ” ê²ƒì´ì£ .

ìµœì¢…ì ì¸ ê°œì„  ê²°ê³¼ë¬¼ì€ ë‹¤ìŒê³¼ ê°™ìŠµë‹ˆë‹¤.
![ìµœì¢… ê°œì„ ](https://velog.velcdn.com/images/n0eyes/post/5b209c7f-d0f4-42f8-9e3b-fcc78572ed61/image.gif)

## ë§ˆë¬´ë¦¬
í”„ë¡œì íŠ¸ì—ì„œ ì´ë¯¸ì§€ë¥¼ ë‹¤ë£¨ë©° ê²½í—˜í–ˆë˜ ë¶ˆí¸ ì‚¬í•­ì„ ê°œì„ í•˜ëŠ” ê³¼ì •ì„ ê³µìœ í•´ ë³´ì•˜ìŠµë‹ˆë‹¤. ì¡°ê¸ˆì´ë¼ë„ ë„ì›€ì´ ë˜ì—ˆìœ¼ë©´ ì¢‹ê² ìŠµë‹ˆë‹¤. ğŸ˜„

ê²°ë¡  : ë¶ˆí¸í–ˆë˜ ì´ë¯¸ì§€ ê²½í—˜ì€ ì‚¬ì‹¤ UXì™€ DX ëª¨ë‘ì˜€ë‹¤.

## ì°¸ê³ 

- https://fe-developers.kakaoent.com/2021/211127-211209-suspense/